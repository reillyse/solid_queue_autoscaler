# frozen_string_literal: true

class CreateSolidQueueAutoscalerState < ActiveRecord::Migration<%= migration_version %>
  # Use the same database connection as SolidQueue for multi-database setups
  def self.connection
    if defined?(SolidQueue::Record) && SolidQueue::Record.respond_to?(:connection)
      SolidQueue::Record.connection
    else
      super
    end
  end

  def change
    create_table :solid_queue_autoscaler_state do |t|
      t.string :key, null: false
      t.datetime :last_scale_up_at
      t.datetime :last_scale_down_at

      t.timestamps
    end

    add_index :solid_queue_autoscaler_state, :key, unique: true
  end
end
