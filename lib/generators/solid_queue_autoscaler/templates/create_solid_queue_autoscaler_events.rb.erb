# frozen_string_literal: true

# Migration for SolidQueueAutoscaler events table (for dashboard and event history).
#
# For multi-database setups (SolidQueue in separate database):
#   This migration should be placed in db/queue_migrate/ (or your queue DB's migration path)
#   Run with: rails db:migrate:queue
#
# For single-database setups:
#   Place in db/migrate/ and run: rails db:migrate
#
class CreateSolidQueueAutoscalerEvents < ActiveRecord::Migration<%= migration_version %>
  def change
    create_table :solid_queue_autoscaler_events do |t|
      t.string :worker_name, null: false, default: 'default'
      t.string :action, null: false
      t.integer :from_workers, null: false
      t.integer :to_workers, null: false
      t.string :reason
      t.integer :queue_depth
      t.float :latency_seconds
      t.text :metrics_json
      t.boolean :dry_run, default: false
      t.datetime :created_at, null: false
    end

    add_index :solid_queue_autoscaler_events, :created_at
    add_index :solid_queue_autoscaler_events, :worker_name
    add_index :solid_queue_autoscaler_events, :action
  end
end
